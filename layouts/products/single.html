{{ define "main" }}
<div class="product-page">
  <div class="gallery">
    <div class="gallery-images">
      {{ if .Params.images }}
        {{ range .Params.images }}
          <img src="{{ printf "/images/%s" . }}" alt="{{ $.Title }}" class="gallery-img" />
        {{ end }}
      {{ else }}
        <div class="placeholder-img">{{ .Title }}</div>
      {{ end }}
    </div>
    <div class="delivery-returns">
      <div class="delivery-returns-header" onclick="toggleDeliveryReturns(this)">
        <span>DELIVERY & RETURN</span>
        <span>+</span>
      </div>
      <div class="delivery-returns-content">
        <h4>Delivery Information</h4>
        <p>Standard delivery: 3-5 business days</p>
        <p>Express delivery: 1-2 business days</p>
        <p>Free delivery on orders over £100</p>
        <h4>Returns Policy</h4>
        <p>30-day return policy</p>
        <p>Items must be in original condition</p>
        <p>Return shipping costs may apply</p>
      </div>
    </div>
  </div>
  <div class="product-info">
    <div class="sku">SKU: {{ .Params.sku }} | HANDCRAFTED BY ARTISANS</div>
    <h1 class="product-title">{{ .Title }}</h1>
    {{ $cur := .Params.currency | default (site.Params.currency | default "GBP") }}
    {{ $sym := cond (eq (upper $cur) "GBP") "£" (cond (eq (upper $cur) "EUR") "€" "$") }}
    {{ with .Params.price }}<div class="price">{{ $sym }}{{ printf "%.2f" (float .) }}</div>{{ end }}
    {{ if .Params.inStock }}
      <div class="stock-status">✓ In Stock</div>
    {{ else }}
      <div class="stock-status" style="color: #dc3545;">Out of Stock</div>
    {{ end }}
    <div class="qty-selector">
      <label for="quantity">Quantity:</label>
      <div class="qty-controls">
        <button class="qty-btn" onclick="decreaseQty()">−</button>
        <input type="number" id="quantity" class="qty-input" value="1" min="1">
        <button class="qty-btn" onclick="increaseQty()">+</button>
      </div>
    </div>
    <button class="add-to-cart" onclick="addToCart()">Add to Cart</button>
    <div class="product-details">
      <div class="detail-section">
        <p>{{ .Params.description }}</p>
      </div>
      {{ if .Params.specifications }}
      <div class="detail-section">
        <h3>Details you'll appreciate</h3>
        <ul>
          {{ range .Params.specifications }}
            <li>{{ . }}</li>
          {{ end }}
        </ul>
      </div>
      {{ end }}
    </div>
    <!-- Show product details only once below main info -->
    <div class="product-details">
      <div class="detail-section">
        <strong>SKU:</strong> {{ .Params.sku }}<br>
        <strong>Dimensions:</strong> {{ .Params.dimensions }}<br>
        <strong>Material:</strong> {{ .Params.material }}<br>
        <strong>Colour:</strong> {{ .Params.colour }}
      </div>
    </div>
  </div>
</div>
{{ $currentSection := .Section }}
{{ $currentTitle := .Title }}
{{ $relatedProducts := where (where .Site.RegularPages "Section" $currentSection) "Title" "!=" $currentTitle }}
{{ if $relatedProducts }}
<section class="recommendations">
  <h2>You may also like</h2>
  <div class="recommendations-grid">
    {{ range first 3 $relatedProducts }}
      <div class="rec-product">
        {{ if .Params.images }}
          <img src="{{ printf "/images/%s" (index .Params.images 0) }}" alt="{{ .Title }}" />
        {{ else }}
          <div class="placeholder-img">{{ .Title }}</div>
        {{ end }}
        <h3>{{ .Title }}</h3>
        {{ $cur := .Params.currency | default (site.Params.currency | default "GBP") }}
        {{ $sym := cond (eq (upper $cur) "GBP") "£" (cond (eq (upper $cur) "EUR") "€" "$") }}
        {{ with .Params.price }}<div class="price">{{ $sym }}{{ printf "%.2f" (float .) }}</div>{{ end }}
      </div>
    {{ end }}
  </div>
</section>
{{ end }}
<script>
function increaseQty() {
  var input = document.getElementById('quantity');
  input.value = parseInt(input.value) + 1;
}
function decreaseQty() {
  var input = document.getElementById('quantity');
  if (parseInt(input.value) > 1) {
    input.value = parseInt(input.value) - 1;
  }
}
function addToCart() {
  var quantity = document.getElementById('quantity').value;
  alert(`Added ${quantity} {{ .Title }}(s) to cart!`);
}
function toggleDeliveryReturns(header) {
  var content = header.nextElementSibling;
  var symbol = header.querySelector('span:last-child');
  content.classList.toggle('open');
  header.classList.toggle('active');
  symbol.textContent = content.classList.contains('open') ? '×' : '+';
}
</script>
{{ end }}
