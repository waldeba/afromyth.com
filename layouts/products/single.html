{{ define "main" }}
<div class="page">
  <div class="gallery">
    {{ if .Params.images }}
      {{ range .Params.images }}
        {{ $imagePath := printf "/images/%s" . }}
        {{ if fileExists (printf "static%s" $imagePath) }}
          <img src="{{ $imagePath }}" alt="{{ $.Title }}" class="gallery-img">
        {{ else }}
          <div class="placeholder-img">{{ $.Title }}</div>
        {{ end }}
      {{ end }}
    {{ else }}
      <div class="placeholder-img">{{ .Title }}</div>
    {{ end }}
  </div>
  
  <div class="info">
    <div class="breadcrumb">
      <a href="{{ "/" | relURL }}">Home</a> / 
      <a href="{{ .Section | relURL }}/">{{ .Section | title }}</a> / 
      {{ .Title }}
    </div>
    
    <h2>{{ .Title }}</h2>
    
    <div class="price">{{ .Params.price | default "$99.00" }}</div>
    
    {{ if .Params.inStock }}
      <div class="stock-status">✓ In Stock</div>
    {{ else }}
      <div class="stock-status" style="color: #dc3545;">Out of Stock</div>
    {{ end }}
    
    <div class="qty">
      <button type="button" class="qty-minus">−</button>
      <span>1</span>
      <button type="button" class="qty-plus">+</button>
    </div>
    
    {{ if .Params.inStock }}
      <button class="add-to-cart">Add to Cart</button>
    {{ else }}
      <button class="add-to-cart" disabled style="opacity: 0.5; cursor: not-allowed;">Out of Stock</button>
    {{ end }}
    
    <div class="section">
      <h3>Description</h3>
      <div class="content">
        {{ .Content }}
      </div>
    </div>
    
    {{ if .Params.specifications }}
    <div class="section">
      <h3>Specifications</h3>
      <ul>
        {{ range .Params.specifications }}
          <li>{{ . }}</li>
        {{ end }}
      </ul>
    </div>
    {{ end }}
    
    <div class="meta">
      {{ if .Params.category }}
        <div><strong>Category:</strong> {{ .Params.category | title }}</div>
      {{ end }}
      {{ if .Params.tags }}
        <div><strong>Tags:</strong> {{ delimit .Params.tags ", " }}</div>
      {{ end }}
      {{ if .Params.weight }}
        <div><strong>Weight:</strong> {{ .Params.weight }}</div>
      {{ end }}
    </div>
    
    <div class="delivery-returns">
      <div class="delivery-returns-header">
        Delivery & Returns
        <span class="arrow">▼</span>
      </div>
      <div class="delivery-returns-content">
        <h4>Delivery Information</h4>
        <p>Standard delivery: 3-5 business days</p>
        <p>Express delivery: 1-2 business days</p>
        <p>Free delivery on orders over $100</p>
        
        <h4>Returns Policy</h4>
        <p>30-day return policy</p>
        <p>Items must be in original condition</p>
        <p>Return shipping costs may apply</p>
      </div>
    </div>
  </div>
</div>

{{ $currentSection := .Section }}
{{ $currentTitle := .Title }}
{{ $relatedProducts := where (where .Site.RegularPages "Section" $currentSection) "Title" "!=" $currentTitle }}
{{ if $relatedProducts }}
<div class="recommendations">
  <h2>You May Also Like</h2>
  <div class="recommendations-grid">
    {{ range first 4 $relatedProducts }}
      <div class="rec-product" onclick="window.location.href='{{ .Permalink }}'">
        {{ if .Params.images }}
          {{ $imagePath := printf "/images/%s" (index .Params.images 0) }}
          {{ if fileExists (printf "static%s" $imagePath) }}
            <img src="{{ $imagePath }}" alt="{{ .Title }}">
          {{ else }}
            <div class="placeholder-img">{{ .Title }}</div>
          {{ end }}
        {{ else }}
          <div class="placeholder-img">{{ .Title }}</div>
        {{ end }}
        <h3>{{ .Title }}</h3>
        <div class="price">{{ .Params.price | default "$99.00" }}</div>
      </div>
    {{ end }}
  </div>
</div>
{{ end }}
{{ end }}
